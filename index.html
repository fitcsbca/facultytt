<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timetable Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #2c3e50, #4a6491);
            color: white;
            padding: 30px 0;
            text-align: center;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }

        .tabs {
            display: flex;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .tab-btn {
            flex: 1;
            padding: 18px 20px;
            border: none;
            background: none;
            font-size: 1.1rem;
            font-weight: 600;
            color: #555;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-btn:hover {
            background-color: #f0f5ff;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #4a6491, #2c3e50);
            color: white;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .tab-content.active {
            display: block;
        }

        .form-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5eb;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #4a6491;
            box-shadow: 0 0 0 3px rgba(74, 100, 145, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .day-schedule {
            background: #f8fafc;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #e1e5eb;
        }

        .day-schedule h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4a6491;
        }

        .time-slot {
            display: grid;
            grid-template-columns: 150px 1fr;
            gap: 15px;
            margin-bottom: 15px;
            align-items: center;
        }

        .time-input {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4a6491, #2c3e50);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(44, 62, 80, 0.2);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }

        .timetable-display {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            overflow-x: auto;
        }

        .timetable-header {
            background: linear-gradient(135deg, #4a6491, #2c3e50);
            color: white;
            padding: 20px;
            border-radius: 8px 8px 0 0;
            margin-bottom: 20px;
        }

        .timetable-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1000px;
        }

        .timetable-table th {
            background: #f8f9fa;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #2c3e50;
            border-bottom: 2px solid #dee2e6;
        }

        .timetable-table td {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
            vertical-align: top;
        }

        .timetable-table tr:hover {
            background-color: #f8fafc;
        }

        .time-cell {
            font-weight: 600;
            color: #4a6491;
            background: #f0f5ff;
            width: 150px;
        }

        .subject-info {
            background: #e8f4ff;
            padding: 8px 12px;
            border-radius: 4px;
            margin-bottom: 5px;
            border-left: 4px solid #4a6491;
        }

        .professor {
            color: #666;
            font-size: 0.9rem;
            margin-top: 3px;
        }

        .room {
            color: #888;
            font-size: 0.85rem;
            font-style: italic;
        }

        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-select {
            padding: 10px 15px;
            border: 2px solid #e1e5eb;
            border-radius: 6px;
            background: white;
            font-size: 1rem;
            min-width: 200px;
        }

        .empty-slot {
            color: #999;
            font-style: italic;
        }

        .break-cell {
            background: #fff3cd;
            color: #856404;
            font-weight: 600;
            text-align: center;
        }

        .specialization-cell {
            background: #d4edda;
            color: #155724;
            font-weight: 600;
        }

        .search-box {
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5eb;
            border-radius: 6px;
            font-size: 1rem;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            text-align: center;
        }

        .stat-card h3 {
            color: #4a6491;
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .stat-card p {
            color: #666;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .time-slot {
                grid-template-columns: 1fr;
            }
            
            .timetable-table {
                font-size: 0.9rem;
            }
            
            .timetable-table th,
            .timetable-table td {
                padding: 10px 5px;
            }
        }

        .alert {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4a6491;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .day-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .day-btn {
            padding: 8px 15px;
            border: 2px solid #e1e5eb;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .day-btn:hover {
            background: #f0f5ff;
        }

        .day-btn.active {
            background: #4a6491;
            color: white;
            border-color: #4a6491;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìö University Timetable Management System</h1>
            <p>Manage and view academic schedules for BCA/BScIT and IMCA programs</p>
        </header>

        <div class="tabs">
            <button class="tab-btn active" data-tab="add">Add New Timetable</button>
            <button class="tab-btn" data-tab="view">View Timetables</button>
            <button class="tab-btn" data-tab="stats">Statistics</button>
        </div>

        <div class="tab-content active" id="add-tab">
            <div class="form-container">
                <h2 style="color: #2c3e50; margin-bottom: 25px;">Add New Timetable Entry</h2>
                
                <div class="alert" id="form-alert"></div>
                
                <form id="timetable-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="sheet_name">Sheet Name *</label>
                            <input type="text" id="sheet_name" class="form-control" required placeholder="e.g., Table 1">
                        </div>
                        
                        <div class="form-group">
                            <label for="course">Course *</label>
                            <select id="course" class="form-control" required>
                                <option value="">Select Course</option>
                                <option value="BCA/BScIT">BCA/BScIT</option>
                                <option value="IMCA">IMCA</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="semester">Semester *</label>
                            <select id="semester" class="form-control" required>
                                <option value="">Select Semester</option>
                                <option value="4">Semester 4</option>
                                <option value="5">Semester 5</option>
                                <option value="6">Semester 6</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="division">Division *</label>
                            <select id="division" class="form-control" required>
                                <option value="">Select Division</option>
                                <option value="A">A</option>
                                <option value="B">B</option>
                                <option value="C">C</option>
                                <option value="D">D</option>
                                <option value="E">E</option>
                                <option value="F">F</option>
                                <option value="G">G</option>
                                <option value="H">H</option>
                                <option value="I">I</option>
                                <option value="J">J</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="minor">Minor Specialization</label>
                            <input type="text" id="minor" class="form-control" placeholder="e.g., AI & ML, CSF, Digital Marketing">
                        </div>
                        
                        <div class="form-group">
                            <label for="academic_year">Academic Year *</label>
                            <input type="text" id="academic_year" class="form-control" required placeholder="e.g., 2025-26 EVEN">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="effective_from">Effective From *</label>
                            <input type="date" id="effective_from" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="location">Location *</label>
                            <input type="text" id="location" class="form-control" required placeholder="e.g., BHAGAT SINGH BUILDING">
                        </div>
                    </div>
                    
                    <h3 style="color: #2c3e50; margin: 30px 0 20px 0;">Daily Schedule</h3>
                    
                    <div class="day-buttons">
                        <button type="button" class="day-btn active" data-day="Monday">Monday</button>
                        <button type="button" class="day-btn" data-day="Tuesday">Tuesday</button>
                        <button type="button" class="day-btn" data-day="Wednesday">Wednesday</button>
                        <button type="button" class="day-btn" data-day="Thursday">Thursday</button>
                        <button type="button" class="day-btn" data-day="Friday">Friday</button>
                        <button type="button" class="day-btn" data-day="Saturday">Saturday</button>
                    </div>
                    
                    <div id="day-schedules">
                        <!-- Day schedules will be dynamically added here -->
                    </div>
                    
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">
                            <span>üíæ Save Timetable</span>
                        </button>
                        <button type="button" class="btn btn-secondary" id="reset-form">
                            <span>üîÑ Reset Form</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <div class="tab-content" id="view-tab">
            <div class="filters">
                <select id="filter-course" class="filter-select">
                    <option value="">All Courses</option>
                    <option value="BCA/BScIT">BCA/BScIT</option>
                    <option value="IMCA">IMCA</option>
                </select>
                
                <select id="filter-semester" class="filter-select">
                    <option value="">All Semesters</option>
                    <option value="4">Semester 4</option>
                    <option value="5">Semester 5</option>
                    <option value="6">Semester 6</option>
                </select>
                
                <select id="filter-division" class="filter-select">
                    <option value="">All Divisions</option>
                    <option value="A">A</option>
                    <option value="B">B</option>
                    <option value="C">C</option>
                    <option value="D">D</option>
                    <option value="E">E</option>
                    <option value="F">F</option>
                    <option value="G">G</option>
                    <option value="H">H</option>
                    <option value="I">I</option>
                    <option value="J">J</option>
                </select>
                
                <select id="filter-minor" class="filter-select">
                    <option value="">All Minors</option>
                    <option value="AI & ML">AI & ML</option>
                    <option value="CSF">CSF</option>
                    <option value="Digital Marketing">Digital Marketing</option>
                    <option value="Animation">Animation</option>
                    <option value="Animation+Photography+Videography">Animation+Photography+Videography</option>
                </select>
                
                <button class="btn btn-primary" id="apply-filters">Apply Filters</button>
                <button class="btn btn-secondary" id="reset-filters">Reset Filters</button>
            </div>
            
            <div class="search-box">
                <input type="text" id="search-input" class="search-input" placeholder="Search by professor, subject, or room number...">
            </div>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Loading timetables...</p>
            </div>
            
            <div id="timetable-list">
                <!-- Timetables will be displayed here -->
            </div>
        </div>
        
        <div class="tab-content" id="stats-tab">
            <div class="stats">
                <div class="stat-card">
                    <h3 id="total-timetables">0</h3>
                    <p>Total Timetables</p>
                </div>
                <div class="stat-card">
                    <h3 id="total-classes">0</h3>
                    <p>Total Classes Scheduled</p>
                </div>
                <div class="stat-card">
                    <h3 id="total-professors">0</h3>
                    <p>Unique Professors</p>
                </div>
                <div class="stat-card">
                    <h3 id="total-rooms">0</h3>
                    <p>Classrooms/Labs Used</p>
                </div>
            </div>
            
            <div class="timetable-display">
                <h2 style="color: #2c3e50; margin-bottom: 20px;">Statistics Overview</h2>
                <div id="stats-details">
                    <!-- Statistics details will be displayed here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sample data storage (in a real app, this would be a database)
        let timetables = [];
        
        // DOM Elements
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        const form = document.getElementById('timetable-form');
        const dayBtns = document.querySelectorAll('.day-btn');
        const daySchedules = document.getElementById('day-schedules');
        const timetableList = document.getElementById('timetable-list');
        const loading = document.getElementById('loading');
        const statsDetails = document.getElementById('stats-details');
        
        // Initialize day schedules
        const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        const timeSlots = [
            { id: '1', time: '09:30 AM To 10:25 AM' },
            { id: '2', time: '10:25 AM To 11:20 AM' },
            { id: 'Recess', time: 'Lunch Break (11:20 TO 12:20)' },
            { id: '3', time: '12:20 PM To 01:15 PM' },
            { id: '4', time: '01:15 PM To 02:10 PM' },
            { id: 'Recess_2', time: 'Short Break (02:10 TO 02:30)' },
            { id: '5', time: '02:30 PM to 03:25 PM' },
            { id: '6', time: '03:25 PM to 04:20 PM' }
        ];
        
        // Tab switching
        tabBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const tabId = btn.getAttribute('data-tab');
                
                // Update active tab button
                tabBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                // Update active tab content
                tabContents.forEach(content => content.classList.remove('active'));
                document.getElementById(`${tabId}-tab`).classList.add('active');
                
                // Load data when switching to view tab
                if (tabId === 'view') {
                    loadTimetables();
                } else if (tabId === 'stats') {
                    updateStatistics();
                }
            });
        });
        
        // Day switching in form
        dayBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const day = btn.getAttribute('data-day');
                
                // Update active day button
                dayBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                // Update day schedule display
                updateDaySchedule(day);
            });
        });
        
        // Initialize day schedules
        function initializeDaySchedules() {
            days.forEach(day => {
                const daySchedule = document.createElement('div');
                daySchedule.className = 'day-schedule';
                daySchedule.id = `schedule-${day}`;
                daySchedule.style.display = day === 'Monday' ? 'block' : 'none';
                
                const dayHeader = document.createElement('h4');
                dayHeader.textContent = day;
                daySchedule.appendChild(dayHeader);
                
                timeSlots.forEach(slot => {
                    const slotDiv = document.createElement('div');
                    slotDiv.className = 'time-slot';
                    
                    const timeLabel = document.createElement('label');
                    timeLabel.textContent = slot.time;
                    timeLabel.style.fontWeight = '600';
                    
                    const subjectInput = document.createElement('input');
                    subjectInput.type = 'text';
                    subjectInput.className = 'form-control';
                    subjectInput.id = `${day}-${slot.id}-subject`;
                    subjectInput.placeholder = slot.id.includes('Recess') ? 'Break description' : 'Enter subject/professor/room';
                    
                    slotDiv.appendChild(timeLabel);
                    slotDiv.appendChild(subjectInput);
                    daySchedule.appendChild(slotDiv);
                });
                
                daySchedules.appendChild(daySchedule);
            });
        }
        
        // Update day schedule display
        function updateDaySchedule(day) {
            days.forEach(d => {
                const schedule = document.getElementById(`schedule-${d}`);
                schedule.style.display = d === day ? 'block' : 'none';
            });
        }
        
        // Form submission
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Collect form data
            const timetable = {
                sheet_name: document.getElementById('sheet_name').value,
                course: document.getElementById('course').value,
                semester: document.getElementById('semester').value,
                division: document.getElementById('division').value,
                minor: document.getElementById('minor').value,
                academic_year: document.getElementById('academic_year').value,
                effective_from: document.getElementById('effective_from').value,
                location: document.getElementById('location').value,
                schedule: {}
            };
            
            // Collect schedule data for each day
            days.forEach(day => {
                timetable.schedule[day] = {};
                timeSlots.forEach(slot => {
                    const input = document.getElementById(`${day}-${slot.id}-subject`);
                    timetable.schedule[day][slot.id] = input.value || '(Empty)';
                });
            });
            
            // Add to timetables array
            timetables.push(timetable);
            
            // Show success message
            showAlert('Timetable added successfully!', 'success');
            
            // Reset form
            form.reset();
            
            // Reset day schedules
            days.forEach(day => {
                timeSlots.forEach(slot => {
                    const input = document.getElementById(`${day}-${slot.id}-subject`);
                    input.value = '';
                });
            });
            
            // Switch to first day
            dayBtns.forEach(b => b.classList.remove('active'));
            dayBtns[0].classList.add('active');
            updateDaySchedule('Monday');
            
            // Save to localStorage
            saveToLocalStorage();
        });
        
        // Reset form
        document.getElementById('reset-form').addEventListener('click', function() {
            if (confirm('Are you sure you want to reset the form? All entered data will be lost.')) {
                form.reset();
                days.forEach(day => {
                    timeSlots.forEach(slot => {
                        const input = document.getElementById(`${day}-${slot.id}-subject`);
                        input.value = '';
                    });
                });
                showAlert('Form has been reset.', 'success');
            }
        });
        
        // Load timetables
        function loadTimetables(filters = {}) {
            loading.style.display = 'block';
            timetableList.innerHTML = '';
            
            // Simulate loading delay
            setTimeout(() => {
                let filteredTimetables = [...timetables];
                
                // Apply filters
                if (filters.course) {
                    filteredTimetables = filteredTimetables.filter(t => t.course === filters.course);
                }
                if (filters.semester) {
                    filteredTimetables = filteredTimetables.filter(t => t.semester === filters.semester);
                }
                if (filters.division) {
                    filteredTimetables = filteredTimetables.filter(t => t.division === filters.division);
                }
                if (filters.minor) {
                    filteredTimetables = filteredTimetables.filter(t => t.minor === filters.minor);
                }
                
                if (filteredTimetables.length === 0) {
                    timetableList.innerHTML = '<div class="alert alert-error">No timetables found matching your criteria.</div>';
                } else {
                    filteredTimetables.forEach((timetable, index) => {
                        const timetableElement = createTimetableElement(timetable, index);
                        timetableList.appendChild(timetableElement);
                    });
                }
                
                loading.style.display = 'none';
            }, 500);
        }
        
        // Create timetable display element
        function createTimetableElement(timetable, index) {
            const div = document.createElement('div');
            div.className = 'timetable-display';
            div.style.marginBottom = '30px';
            
            // Header
            const header = document.createElement('div');
            header.className = 'timetable-header';
            header.innerHTML = `
                <h3>${timetable.course} - Semester ${timetable.semester}, Division ${timetable.division}</h3>
                <p>Minor: ${timetable.minor} | Academic Year: ${timetable.academic_year} | Effective From: ${timetable.effective_from}</p>
                <p>Location: ${timetable.location}</p>
            `;
            div.appendChild(header);
            
            // Day tabs for the timetable
            const dayTabs = document.createElement('div');
            dayTabs.className = 'day-buttons';
            dayTabs.style.marginTop = '20px';
            
            days.forEach(day => {
                const dayBtn = document.createElement('button');
                dayBtn.type = 'button';
                dayBtn.className = 'day-btn';
                dayBtn.textContent = day;
                dayBtn.addEventListener('click', () => {
                    // Update active day button
                    dayTabs.querySelectorAll('.day-btn').forEach(b => b.classList.remove('active'));
                    dayBtn.classList.add('active');
                    
                    // Update table display
                    updateTimetableTable(table, timetable, day);
                });
                dayTabs.appendChild(dayBtn);
            });
            
            // Make first day active
            dayTabs.querySelector('.day-btn').classList.add('active');
            
            div.appendChild(dayTabs);
            
            // Table
            const table = document.createElement('table');
            table.className = 'timetable-table';
            updateTimetableTable(table, timetable, 'Monday');
            
            div.appendChild(table);
            
            // Action buttons
            const actions = document.createElement('div');
            actions.className = 'action-buttons';
            actions.innerHTML = `
                <button class="btn btn-secondary" onclick="editTimetable(${index})">‚úèÔ∏è Edit</button>
                <button class="btn btn-danger" onclick="deleteTimetable(${index})">üóëÔ∏è Delete</button>
            `;
            div.appendChild(actions);
            
            return div;
        }
        
        // Update timetable table for specific day
        function updateTimetableTable(table, timetable, day) {
            table.innerHTML = `
                <thead>
                    <tr>
                        <th style="width: 150px;">Time Slot</th>
                        <th>Schedule for ${day}</th>
                    </tr>
                </thead>
                <tbody>
                    ${timeSlots.map(slot => {
                        const scheduleText = timetable.schedule[day][slot.id];
                        let cellClass = '';
                        let content = '';
                        
                        if (slot.id.includes('Recess')) {
                            cellClass = 'break-cell';
                            content = scheduleText;
                        } else if (scheduleText.includes('Specialization') || scheduleText.includes('LAB')) {
                            cellClass = 'specialization-cell';
                            content = formatScheduleText(scheduleText);
                        } else if (scheduleText === '(Empty)') {
                            content = '<span class="empty-slot">No class scheduled</span>';
                        } else {
                            content = formatScheduleText(scheduleText);
                        }
                        
                        return `
                            <tr>
                                <td class="time-cell">${slot.time}</td>
                                <td class="${cellClass}">${content}</td>
                            </tr>
                        `;
                    }).join('')}
                </tbody>
            `;
        }
        
        // Format schedule text with HTML
        function formatScheduleText(text) {
            if (!text || text === '(Empty)') return text;
            
            // Split by commas for multiple entries
            const entries = text.split(',').filter(entry => entry.trim());
            
            return entries.map(entry => {
                let html = '<div class="subject-info">';
                const parts = entry.trim().split('-');
                
                if (parts.length > 1) {
                    html += `<strong>${parts[0].trim()}</strong>`;
                    html += `<div class="professor">${parts.slice(1).join('-').trim()}</div>`;
                    
                    // Extract room number if present
                    const roomMatch = entry.match(/\(([^)]+)\)|room no (\d+)|classroom no (\d+)|lab no (\d+)/i);
                    if (roomMatch) {
                        const room = roomMatch[1] || roomMatch[2] || roomMatch[3] || roomMatch[4];
                        html += `<div class="room">üìç ${room}</div>`;
                    }
                } else {
                    html += entry.trim();
                }
                
                html += '</div>';
                return html;
            }).join('');
        }
        
        // Apply filters
        document.getElementById('apply-filters').addEventListener('click', function() {
            const filters = {
                course: document.getElementById('filter-course').value,
                semester: document.getElementById('filter-semester').value,
                division: document.getElementById('filter-division').value,
                minor: document.getElementById('filter-minor').value
            };
            loadTimetables(filters);
        });
        
        // Reset filters
        document.getElementById('reset-filters').addEventListener('click', function() {
            document.getElementById('filter-course').value = '';
            document.getElementById('filter-semester').value = '';
            document.getElementById('filter-division').value = '';
            document.getElementById('filter-minor').value = '';
            document.getElementById('search-input').value = '';
            loadTimetables();
        });
        
        // Search functionality
        document.getElementById('search-input').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            
            if (searchTerm.length < 2) {
                loadTimetables();
                return;
            }
            
            const filtered = timetables.filter(timetable => {
                // Search in schedule text
                for (const day in timetable.schedule) {
                    for (const slot in timetable.schedule[day]) {
                        if (timetable.schedule[day][slot].toLowerCase().includes(searchTerm)) {
                            return true;
                        }
                    }
                }
                
                // Search in metadata
                return (
                    timetable.course.toLowerCase().includes(searchTerm) ||
                    timetable.division.toLowerCase().includes(searchTerm) ||
                    timetable.minor.toLowerCase().includes(searchTerm) ||
                    timetable.location.toLowerCase().includes(searchTerm)
                );
            });
            
            displaySearchResults(filtered);
        });
        
        // Display search results
        function displaySearchResults(filteredTimetables) {
            timetableList.innerHTML = '';
            
            if (filteredTimetables.length === 0) {
                timetableList.innerHTML = '<div class="alert alert-error">No matching timetables found.</div>';
                return;
            }
            
            filteredTimetables.forEach((timetable, index) => {
                // Find original index for edit/delete
                const originalIndex = timetables.findIndex(t => 
                    t.sheet_name === timetable.sheet_name && 
                    t.division === timetable.division
                );
                
                const timetableElement = createTimetableElement(timetable, originalIndex);
                timetableList.appendChild(timetableElement);
            });
        }
        
        // Update statistics
        function updateStatistics() {
            // Update stats cards
            document.getElementById('total-timetables').textContent = timetables.length;
            
            let totalClasses = 0;
            let professors = new Set();
            let rooms = new Set();
            
            timetables.forEach(timetable => {
                days.forEach(day => {
                    timeSlots.forEach(slot => {
                        const schedule = timetable.schedule[day][slot.id];
                        if (schedule && schedule !== '(Empty)' && !slot.id.includes('Recess')) {
                            totalClasses++;
                            
                            // Extract professors
                            const profMatches = schedule.match(/Prof\.?\s+([A-Z][a-z]+(?:\s+[A-Z][a-z]+)?)/g);
                            if (profMatches) {
                                profMatches.forEach(prof => professors.add(prof));
                            }
                            
                            const drMatches = schedule.match(/Dr\.?\s+([A-Z][a-z]+(?:\s+[A-Z][a-z]+)?)/g);
                            if (drMatches) {
                                drMatches.forEach(dr => professors.add(dr));
                            }
                            
                            // Extract rooms
                            const roomMatches = schedule.match(/(?:classroom|room|lab)\s+no\s+(\d+)/gi);
                            if (roomMatches) {
                                roomMatches.forEach(room => rooms.add(room));
                            }
                        }
                    });
                });
            });
            
            document.getElementById('total-classes').textContent = totalClasses;
            document.getElementById('total-professors').textContent = professors.size;
            document.getElementById('total-rooms').textContent = rooms.size;
            
            // Update stats details
            statsDetails.innerHTML = `
                <h3>Course Distribution</h3>
                <div style="margin: 20px 0;">
                    ${getCourseDistribution()}
                </div>
                
                <h3>Division Distribution</h3>
                <div style="margin: 20px 0;">
                    ${getDivisionDistribution()}
                </div>
                
                <h3>Minor Specialization Distribution</h3>
                <div style="margin: 20px 0;">
                    ${getMinorDistribution()}
                </div>
            `;
        }
        
        // Get course distribution HTML
        function getCourseDistribution() {
            const distribution = {};
            timetables.forEach(t => {
                distribution[t.course] = (distribution[t.course] || 0) + 1;
            });
            
            return Object.entries(distribution).map(([course, count]) => `
                <div style="margin-bottom: 10px;">
                    <strong>${course}:</strong> ${count} timetable(s)
                    <div style="background: #e9ecef; height: 10px; border-radius: 5px; margin-top: 5px;">
                        <div style="background: #4a6491; height: 100%; width: ${(count / timetables.length) * 100}%; border-radius: 5px;"></div>
                    </div>
                </div>
            `).join('');
        }
        
        // Get division distribution HTML
        function getDivisionDistribution() {
            const distribution = {};
            timetables.forEach(t => {
                distribution[t.division] = (distribution[t.division] || 0) + 1;
            });
            
            // Sort divisions
            const sortedDivisions = Object.keys(distribution).sort();
            
            return sortedDivisions.map(division => `
                <span style="display: inline-block; background: #4a6491; color: white; padding: 5px 10px; margin: 5px; border-radius: 4px;">
                    Division ${division}: ${distribution[division]}
                </span>
            `).join('');
        }
        
        // Get minor distribution HTML
        function getMinorDistribution() {
            const distribution = {};
            timetables.forEach(t => {
                const minor = t.minor || 'Not Specified';
                distribution[minor] = (distribution[minor] || 0) + 1;
            });
            
            return Object.entries(distribution).map(([minor, count]) => `
                <div style="display: inline-block; text-align: center; margin: 10px; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); min-width: 150px;">
                    <div style="font-size: 1.2rem; font-weight: bold; color: #4a6491;">${count}</div>
                    <div style="font-size: 0.9rem; color: #666;">${minor}</div>
                </div>
            `).join('');
        }
        
        // Edit timetable
        window.editTimetable = function(index) {
            showAlert('Edit functionality is not implemented in this demo. In a real application, this would open the edit form with pre-filled data.', 'error');
        };
        
        // Delete timetable
        window.deleteTimetable = function(index) {
            if (confirm('Are you sure you want to delete this timetable? This action cannot be undone.')) {
                timetables.splice(index, 1);
                saveToLocalStorage();
                loadTimetables();
                updateStatistics();
                showAlert('Timetable deleted successfully.', 'success');
            }
        };
        
        // Show alert message
        function showAlert(message, type) {
            const alertDiv = document.getElementById('form-alert');
            alertDiv.textContent = message;
            alertDiv.className = `alert alert-${type}`;
            alertDiv.style.display = 'block';
            
            setTimeout(() => {
                alertDiv.style.display = 'none';
            }, 5000);
        }
        
        // Save to localStorage
        function saveToLocalStorage() {
            localStorage.setItem('timetables', JSON.stringify(timetables));
        }
        
        // Load from localStorage
        function loadFromLocalStorage() {
            const saved = localStorage.getItem('timetables');
            if (saved) {
                timetables = JSON.parse(saved);
            }
        }
        
        // Load sample data on first run
        function loadSampleData() {
            if (timetables.length === 0) {
                // You could load the JSON data here if needed
                console.log('No timetables found. Add new timetables using the form.');
            }
        }
        
        // Initialize the application
        function init() {
            initializeDaySchedules();
            loadFromLocalStorage();
            loadSampleData();
            
            // Set default date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('effective_from').value = today;
            
            // Load initial data
            loadTimetables();
            updateStatistics();
        }
        
        // Start the application
        init();
    </script>
</body>
</html>
